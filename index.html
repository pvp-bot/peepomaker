<html>
<head>
    <title>peepo maker</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue" rel="stylesheet">
</head>
<style>
    body {background-color: #ede8df;color: #393938;text-align: center;font-family: "Comic Neue", sans-serif;}
</style>
<body>
    <!-- from BarryCarlyon: https://github.com/BarryCarlyon/twitch_misc/blob/main/authentication/implicit_auth/index.html -->

    <img src="icon.png">
    <div id="instructions" style="font-size: 2.0rem;"></div>
    <div id="access_token" style="font-size: 3.0rem;font-weight: bold;"></div>
    
    <script type="text/javascript">
        // These are set for the GitHub Pages Example
        var client_id = 'uajuvalhp72k4yc7lebcj0wmmqm9gx';
        var redirect = 'https://pvp-bot.github.io/peepomaker/';

        document.getElementById('instructions').textContent = '';
        document.getElementById('access_token').textContent = '';

        if (document.location.hash && document.location.hash != '') {
            var parsedHash = new URLSearchParams(window.location.hash.slice(1));
            if (parsedHash.get('access_token')) {
                var access_token = parsedHash.get('access_token');
                document.getElementById('instructions').textContent = `paste this access token into peepo maker:`;
                document.getElementById('access_token').textContent = `${access_token}`;

                // document.getElementById('user_data').textContent = 'Loading';

                // call API
                // fetch(
                //     'https://api.twitch.tv/helix/users',
                //     {
                //         "headers": {
                //             "Client-ID": client_id,
                //             "Authorization": `Bearer ${access_token}`
                //         }
                //     }
                // )
                // .then(resp => resp.json())
                // .then(resp => {
                //     document.getElementById('user_data').innerHTML = '<p>Your Twitch Profile from Helix:</p>';
                //     var table = document.createElement('table');
                //     document.getElementById('user_data').append(table);
                //     for (var key in resp.data[0]) {
                //         var tr = document.createElement('tr');
                //         table.append(tr);
                //         var td = document.createElement('td');
                //         td.textContent = key;
                //         tr.append(td);
                //         var td = document.createElement('td');
                //         td.textContent = resp.data[0][key];
                //         tr.append(td);
                //     }
                // })
                // .catch(err => {
                //     console.log(err);
                //     document.getElementById('user_data').textContent = 'Something went wrong';
                // });
            }
        } else if (document.location.search && document.location.search != '') {
            var parsedParams = new URLSearchParams(window.location.search);
            if (parsedParams.get('error_description')) {
                document.getElementById('access_token').textContent = `${parsedParams.get('error')} - ${parsedParams.get('error_description')}`;
            }
        }
            
    </script>
</body>
</html>
